<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dafa - free internet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .iframe-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            z-index: 1;
        }
        
        .responsive-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .nav-blur {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.8);
            transform: translateY(-100%);
            transition: transform 0.3s ease-in-out;
        }
        
        .nav-blur.show {
            transform: translateY(0);
        }
        
        .nav-blur:hover {
            transform: translateY(0);
        }
        
        #mobile-menu-button {
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        #mobile-menu-button:active {
            background-color: rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- Navigation Bar -->
    <nav class="nav-blur fixed w-full z-20 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <img src="https://en.minghui.org/s/images/home/external/mh-logo-falun/mh-logo-falun.png" alt="Minghui Logo" class="h-8 w-auto">
                    </div>
                                         <div class="hidden md:block">
                         <div class="ml-10 flex items-baseline space-x-4" id="desktop-menu">
                             <!-- Desktop menu items will be generated dynamically -->
                         </div>
                     </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center p-3 rounded-md text-gray-700 hover:text-blue-600 hover:bg-gray-100 focus:outline-none w-12 h-12">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        
                 <!-- Mobile menu -->
         <div class="hidden md:hidden bg-white shadow-lg" id="mobile-menu">
             <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3" id="mobile-menu-items">
                 <!-- Mobile menu items will be generated dynamically -->
             </div>
         </div>
    </nav>
    
    <!-- Main Content -->
    <main class="flex-grow">
        <!-- Loading indicator -->
        <div id="loading" class="loader" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 30;"></div>
        
        <!-- Error message -->
        <div id="error-message" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded z-40">
            <div class="flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                <span>Website không thể load trong iframe. Một số website như Facebook, YouTube không cho phép hiển thị trong iframe.</span>
            </div>
        </div>
        
        <!-- Website iframe container -->
        <div class="iframe-container">
            <iframe id="website-iframe" class="responsive-iframe" frameborder="0" allowfullscreen allow="fullscreen; camera; microphone; geolocation; payment; autoplay; encrypted-media" sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"></iframe>
        </div>
    </main>

    <!-- JavaScript for mobile menu functionality -->
    <script>
        // Mobile menu toggle functionality
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        let isMenuOpen = false;

        // Add multiple event listeners for better compatibility
        mobileMenuButton.addEventListener('click', toggleMobileMenu);
        mobileMenuButton.addEventListener('touchstart', toggleMobileMenu);
        
        function toggleMobileMenu(e) {
            e.preventDefault();
            e.stopPropagation();
            
            isMenuOpen = !isMenuOpen;
            
            if (isMenuOpen) {
                mobileMenu.classList.remove('hidden');
                mobileMenuButton.innerHTML = '<i class="fas fa-times text-xl"></i>';
            } else {
                mobileMenu.classList.add('hidden');
                mobileMenuButton.innerHTML = '<i class="fas fa-bars text-xl"></i>';
            }
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            if (!mobileMenuButton.contains(event.target) && !mobileMenu.contains(event.target)) {
                if (isMenuOpen) {
                    mobileMenu.classList.add('hidden');
                    mobileMenuButton.innerHTML = '<i class="fas fa-bars"></i>';
                    isMenuOpen = false;
                }
            }
        });

        // Close mobile menu when window is resized to desktop
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 768 && isMenuOpen) {
                mobileMenu.classList.add('hidden');
                mobileMenuButton.innerHTML = '<i class="fas fa-bars"></i>';
                isMenuOpen = false;
            }
        });

        // Add smooth transitions to mobile menu
        mobileMenu.style.transition = 'all 0.3s ease-in-out';

        // Navigation bar show/hide functionality
        const navBar = document.querySelector('.nav-blur');
        let navTimeout;

        // Show nav bar on mouse move to top
        document.addEventListener('mousemove', function(e) {
            if (e.clientY <= 50) {
                navBar.classList.add('show');
                clearTimeout(navTimeout);
            } else {
                navTimeout = setTimeout(() => {
                    navBar.classList.remove('show');
                }, 2000);
            }
        });

        // Show nav bar on scroll
        let lastScrollTop = 0;
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if (scrollTop > lastScrollTop) {
                // Scrolling down
                navBar.classList.remove('show');
            } else {
                // Scrolling up
                navBar.classList.add('show');
            }
            lastScrollTop = scrollTop;
        });

        // Website configuration and loading functionality
        const iframe = document.getElementById('website-iframe');
        const loading = document.getElementById('loading');
        let websiteConfig = {};
        
        // Show loading when iframe is loading
        iframe.addEventListener('load', function() {
            loading.style.display = 'none';
        });
        
        iframe.addEventListener('loadstart', function() {
            loading.style.display = 'block';
        });
        
        // Handle iframe errors
        iframe.addEventListener('error', function() {
            console.error('Iframe failed to load');
            loading.style.display = 'none';
            showErrorMessage();
        });
        
        // Function to show error message
        function showErrorMessage() {
            const errorMessage = document.getElementById('error-message');
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }
        
        // Function to check if website allows iframe
        function checkIframeSupport(url) {
            const blockedSites = [
                'facebook.com',
                'instagram.com',
                'twitter.com',
                'linkedin.com',
                'youtube.com'
            ];
            
            return !blockedSites.some(site => url.includes(site));
        }

        // Function to generate menu items
        function generateMenuItems() {
            const desktopMenu = document.getElementById('desktop-menu');
            const mobileMenuItems = document.getElementById('mobile-menu-items');
            
            // Clear existing menu items
            desktopMenu.innerHTML = '';
            mobileMenuItems.innerHTML = '';
            
            // Get all domains from config
            const domains = Object.keys(websiteConfig);
            
            domains.forEach((domain, index) => {
                // Create desktop menu item
                const desktopLink = document.createElement('a');
                desktopLink.href = '#';
                desktopLink.className = index === 0 ? 'text-blue-600 px-3 py-2 rounded-md text-sm font-medium' : 'text-gray-700 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium';
                desktopLink.textContent = domain;
                desktopMenu.appendChild(desktopLink);
                
                // Create mobile menu item
                const mobileLink = document.createElement('a');
                mobileLink.href = '#';
                mobileLink.className = index === 0 ? 'text-blue-600 block px-3 py-2 rounded-md text-base font-medium' : 'text-gray-700 hover:text-blue-600 block px-3 py-2 rounded-md text-base font-medium';
                mobileLink.textContent = domain;
                mobileMenuItems.appendChild(mobileLink);
            });
        }

        // Function to load configuration from JSON
        async function loadConfig() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/vn-dafa/vn-dafa.github.io/refs/heads/main/config.json');
                if (!response.ok) {
                    throw new Error('Failed to load config');
                }
                websiteConfig = await response.json();
                console.log('Config loaded:', websiteConfig);
                
                // Generate menu items from config
                generateMenuItems();
                
                // Load default website (first domain in config)
                const firstDomain = Object.keys(websiteConfig)[0];
                if (firstDomain && websiteConfig[firstDomain]) {
                    iframe.src = websiteConfig[firstDomain];
                }
            } catch (error) {
                console.error('Error loading config:', error);
                // Fallback to default URLs if config fails to load
                websiteConfig = {
                    'vn.minghui.org': 'https://vn.minghui.org',
                    'vi.falundafa.org': 'https://vi.falundafa.org'
                };
                generateMenuItems();
                const firstDomain = Object.keys(websiteConfig)[0];
                if (firstDomain && websiteConfig[firstDomain]) {
                    iframe.src = websiteConfig[firstDomain];
                }
            }
        }

        // Function to load website
        function loadWebsite(domain) {
            if (websiteConfig[domain]) {
                const url = websiteConfig[domain];
                
                // Check if website supports iframe
                if (!checkIframeSupport(url)) {
                    console.warn('Website may not support iframe:', domain);
                    // Still try to load, but show warning
                }
                
                loading.style.display = 'block';
                
                // Add error handling for iframe
                iframe.onerror = function() {
                    console.error('Failed to load:', domain);
                    loading.style.display = 'none';
                };
                
                // Handle iframe load errors
                iframe.onload = function() {
                    loading.style.display = 'none';
                };
                
                // Try to load the website
                try {
                    iframe.src = url;
                } catch (error) {
                    console.error('Error loading website:', error);
                    loading.style.display = 'none';
                }
                
                // Reset all links to gray color first
                const allLinks = document.querySelectorAll('#desktop-menu a, #mobile-menu-items a');
                allLinks.forEach(link => {
                    link.classList.remove('text-blue-600');
                    link.classList.add('text-gray-700', 'hover:text-blue-600');
                });
                
                // Update desktop menu colors
                const desktopLinks = document.querySelectorAll('#desktop-menu a');
                desktopLinks.forEach(link => {
                    if (link.textContent === domain) {
                        link.classList.remove('text-gray-700', 'hover:text-blue-600');
                        link.classList.add('text-blue-600');
                    }
                });
                
                // Update mobile menu colors
                const mobileLinks = document.querySelectorAll('#mobile-menu-items a');
                mobileLinks.forEach(link => {
                    if (link.textContent === domain) {
                        link.classList.remove('text-gray-700', 'hover:text-blue-600');
                        link.classList.add('text-blue-600');
                    }
                });
            }
        }

        // Function to add event listeners to menu items
        function addMenuEventListeners() {
            // Desktop menu items
            const desktopLinks = document.querySelectorAll('#desktop-menu a');
            desktopLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const domain = this.textContent;
                    loadWebsite(domain);
                    
                    // Close mobile menu if open
                    if (isMenuOpen) {
                        mobileMenu.classList.add('hidden');
                        mobileMenuButton.innerHTML = '<i class="fas fa-bars text-xl"></i>';
                        isMenuOpen = false;
                    }
                });
            });

            // Mobile menu items
            const mobileLinks = document.querySelectorAll('#mobile-menu-items a');
            mobileLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const domain = this.textContent;
                    loadWebsite(domain);
                    
                    // Close mobile menu
                    mobileMenu.classList.add('hidden');
                    mobileMenuButton.innerHTML = '<i class="fas fa-bars text-xl"></i>';
                    isMenuOpen = false;
                });
            });
        }

        // Add click event listeners to menu items
        document.addEventListener('DOMContentLoaded', async function() {
            // Load configuration first
            await loadConfig();
            
            // Add event listeners to generated menu items
            addMenuEventListeners();
        });
    </script>
</body>
</html>
